(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1235],{137:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/contract-api-reference/eth-permanent-registrar/controller",function(){return n(4478)}])},2638:function(e,r,n){"use strict";n.d(r,{O:function(){return c},m:function(){return o}});var t=n(4637),i=n(9803),s=n.n(i),a=n(9496),o=function(e){var r=e.children,n=Array.isArray(r)?r:[r],i=(0,a.useState)(n.at(0).props.title),o=i[0],c=i[1];return(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("div",{className:"flex w-fit border-l border-l-ensl-border",style:{marginBottom:"-1px"},children:n.map((function(e,r){return(0,t.jsx)("button",{className:s()("p-2 pb-4 border-r border-t border-b",e.props.title==o?"bg-white border-ensl-border border-b-ensl-background border-b z-10":"bg-ensl-backgroundSecondary border-ensl-border hover:brightness-105"),onClick:function(){return c(e.props.title)},children:e.props.title},r)}))}),(0,t.jsx)("div",{className:"border border-ensl-border bg-ensl-background px-6",children:n.map((function(e,r){return(0,t.jsx)("div",{className:s()(o==e.props.title?"":"hidden"),children:e},r)}))})]})},c=function(e){e.title;var r=e.children;return(0,t.jsx)("div",{children:r})}},8965:function(e,r,n){"use strict";n.d(r,{UW:function(){return s},OK:function(){return a.O},mQ:function(){return a.m}});var t=n(4637),i=(n(9496),{default:"bg-orange-100 text-orange-800 dark:text-orange-300 dark:bg-orange-200 dark:bg-opacity-10",error:"bg-red-200 text-red-900 dark:text-red-200 dark:bg-red-600 dark:bg-opacity-30",warning:"bg-yellow-200 text-yellow-900 dark:text-yellow-200 dark:bg-yellow-700 dark:bg-opacity-30"}),s=function(e){var r=e.children,n=e.type,s=void 0===n?"default":n,a=e.emoji,o=void 0===a?"\ud83d\udca1":a;return(0,t.jsxs)("div",{className:"".concat(i[s]," flex rounded-lg callout mt-6"),children:[(0,t.jsx)("div",{className:"pl-3 pr-2 py-2 select-none text-xl",style:{fontFamily:'"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},children:o}),(0,t.jsx)("div",{className:"pr-4 py-2",children:r})]})},a=n(2638)},4478:function(e,r,n){"use strict";n.r(r);var t=n(4637),i=n(6988),s=n(1177),a=n(2370),o=n(8965),c=function(e){return(0,s.withSSG)((0,i.Z)({filename:"controller.mdx",route:"/contract-api-reference/eth-permanent-registrar/controller",meta:{},pageMap:[{name:"README",route:"/README"},{name:"SUMMARY",route:"/SUMMARY"},{name:"bug-bounty-program",route:"/bug-bounty-program"},{name:"contract-api-reference",children:[{name:"ENS-Contracts-Overview",route:"/contract-api-reference/ENS-Contracts-Overview"},{name:"dns-registrar",route:"/contract-api-reference/dns-registrar"},{name:"ens",route:"/contract-api-reference/ens",frontMatter:{description:"The ENS registry."}},{name:"eth-permanent-registrar",children:[{name:"README",route:"/contract-api-reference/eth-permanent-registrar/README"},{name:"controller",route:"/contract-api-reference/eth-permanent-registrar/controller"},{name:"registrar",route:"/contract-api-reference/eth-permanent-registrar/registrar"}],route:"/contract-api-reference/eth-permanent-registrar"},{name:"name-processing",route:"/contract-api-reference/name-processing",frontMatter:{description:"Describes how to normalize and hash ENS names."}},{name:"publicresolver",route:"/contract-api-reference/publicresolver",frontMatter:{description:"The default public resolver."}},{name:"reverseregistrar",route:"/contract-api-reference/reverseregistrar",frontMatter:{description:"The registrar responsible for managing reverse resolution via the .addr.reverse special-purpose TLD."}},{name:"testregistrar",route:"/contract-api-reference/testregistrar"}],route:"/contract-api-reference"},{name:"contract-developer-guide",children:[{name:"resolving-names-on-chain",route:"/contract-developer-guide/resolving-names-on-chain"},{name:"writing-a-registrar",route:"/contract-developer-guide/writing-a-registrar"},{name:"writing-a-resolver",route:"/contract-developer-guide/writing-a-resolver"}],route:"/contract-developer-guide"},{name:"dapp-developer-guide",children:[{name:"ens-as-nft",route:"/dapp-developer-guide/ens-as-nft"},{name:"ens-enabling-your-dapp",route:"/dapp-developer-guide/ens-enabling-your-dapp"},{name:"ens-l2-offchain",route:"/dapp-developer-guide/ens-l2-offchain"},{name:"ens-libraries",route:"/dapp-developer-guide/ens-libraries"},{name:"front-end-design-guidelines",route:"/dapp-developer-guide/front-end-design-guidelines",frontMatter:{description:"ENS is a tool to simplify the experience for your users. Here are a series of guidelines and tools that will help you make design choices and implement the best ENS user experience."}},{name:"managing-names",route:"/dapp-developer-guide/managing-names"},{name:"registering-and-renewing-names",route:"/dapp-developer-guide/registering-and-renewing-names"},{name:"resolving-names",route:"/dapp-developer-guide/resolving-names"},{name:"working-with-ens",route:"/dapp-developer-guide/working-with-ens"}],route:"/dapp-developer-guide"},{name:"deploying-ens-on-a-private-chain",route:"/deploying-ens-on-a-private-chain"},{name:"developer",children:[{name:"index",route:"/developer"},{name:"meta.json",meta:{index:{title:"Developer Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/developer"},{name:"dns-registrar-guide",route:"/dns-registrar-guide"},{name:"ens-deployments",route:"/ens-deployments"},{name:"ens-improvement-proposals",children:[{name:"README",route:"/ens-improvement-proposals/README",frontMatter:{description:"Standards documentation describing the ENS protocol"}},{name:"ensip-1-ens",route:"/ens-improvement-proposals/ensip-1-ens",frontMatter:{description:"Documentation of the basic ENS protocol (formerly EIP-137)."}},{name:"ensip-10-wildcard-resolution",route:"/ens-improvement-proposals/ensip-10-wildcard-resolution",frontMatter:{description:"Provides a mechanism to support wildcard resolution of ENS names (formerly EIP-2544)."}},{name:"ensip-11-evmchain-address-resolution",route:"/ens-improvement-proposals/ensip-11-evmchain-address-resolution",frontMatter:{description:"Introduces coinType for EVM compatible chains (amending ENSIP9)."}},{name:"ensip-12-avatar-text-records",route:"/ens-improvement-proposals/ensip-12-avatar-text-records",frontMatter:{description:"A standard for storage of the avatar text record in ENS."}},{name:"ensip-2-initial-hash-registrar",route:"/ens-improvement-proposals/ensip-2-initial-hash-registrar",frontMatter:{description:"Describes the hash registrar initially used to register ENS .eth domains (formerly EIP-162)."}},{name:"ensip-3-reverse-resolution",route:"/ens-improvement-proposals/ensip-3-reverse-resolution",frontMatter:{description:"Specifies a TLD, registrar, and resolver interface for reverse resolution of Ethereum addresses using ENS (formerly EIP-181)."}},{name:"ensip-4-support-for-contract-abis",route:"/ens-improvement-proposals/ensip-4-support-for-contract-abis",frontMatter:{description:"A mechanism for storing ABI definitions in ENS, for easy lookup of contract interfaces by callers (formerly EIP-205)."}},{name:"ensip-5-text-records",route:"/ens-improvement-proposals/ensip-5-text-records",frontMatter:{description:"A standard for storage of text records in ENS (formerly EIP-634)."}},{name:"ensip-6-dns-in-ens",route:"/ens-improvement-proposals/ensip-6-dns-in-ens",frontMatter:{description:"Defines a resolver profile for ENS that provides features for storage and lookup of DNS records (formerly EIP-1185)."}},{name:"ensip-7-contenthash-field",route:"/ens-improvement-proposals/ensip-7-contenthash-field",frontMatter:{description:"Introduces a field for storing content addresses and hashes in ENS (formerly EIP-1577)."}},{name:"ensip-8-interface-discovery",route:"/ens-improvement-proposals/ensip-8-interface-discovery",frontMatter:{description:"Defines a method of associating contract interfaces with ENS names and addresses, and of discovering those interfaces (formerly EIP-1844)."}},{name:"ensip-9-multichain-address-resolution",route:"/ens-improvement-proposals/ensip-9-multichain-address-resolution",frontMatter:{description:"Introduces new overloads for the `addr` field for ENS resolvers, which permit resolution of addresses for other blockchains via ENS (formerly EIP-2304)."}}],route:"/ens-improvement-proposals"},{name:"ens-migration-february-2020",children:[{name:"guide-for-dapp-developers",route:"/ens-migration-february-2020/guide-for-dapp-developers"},{name:"technical-description",route:"/ens-migration-february-2020/technical-description"}],route:"/ens-migration-february-2020"},{name:"frequently-asked-questions",route:"/frequently-asked-questions"},{name:"governance",children:[{name:"index",route:"/governance"},{name:"meta.json",meta:{index:{title:"Governance Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/governance"},{name:"index",route:"/",frontMatter:{title:"Welcome"}},{name:"meta.json",meta:{index:{title:"Introduction",type:"docs",hidden:!0,theme:{}},governance:{title:"Governance",type:"nav"},user:{title:"User",type:"nav"},developer:{title:"Developer",type:"nav"},technical:{title:"Technical",type:"nav"}},locale:"en-US"},{name:"permanent-registrar-faq",route:"/permanent-registrar-faq"},{name:"technical",children:[{name:"index",route:"/technical"},{name:"meta.json",meta:{index:{title:"Technical Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/technical"},{name:"terminology",route:"/terminology"},{name:"user",children:[{name:"index",route:"/user"},{name:"meta.json",meta:{index:{title:"User Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/user"}]},a.Z))(e)};function l(e){var r=Object.assign({h1:"h1",p:"p",a:"a",ol:"ol",li:"li",h2:"h2",h3:"h3",pre:"pre",code:"code",strong:"strong"},e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{children:"Controller"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://github.com/ensdomains/ethregistrar/blob/master/contracts/ETHRegistrarController.sol",children:"Source"})}),"\n",(0,t.jsxs)(r.p,{children:["This section documents the parts of the ",(0,t.jsx)(r.a,{href:"https://github.com/ensdomains/ethregistrar/blob/master/contracts/ETHRegistrarController.sol",children:"ETHRegistrarController"})," relevant to implementers of tools that interact with it. Functionality exclusive to the registrar owner is omitted for brevity."]}),"\n",(0,t.jsx)(r.p,{children:"The controller works exclusively with plaintext labels (eg, 'alice' for 'alice.eth')."}),"\n",(0,t.jsx)(r.p,{children:"To prevent frontrunning, the ETHRegistrarController requires a commit/reveal process for new name registrations (but not for renewals). To register a name, the user must:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Generate a commitment hash from the name they want to register and a secret value."}),"\n",(0,t.jsx)(r.li,{children:"Submit the commitment hash from #1 to the controller."}),"\n",(0,t.jsx)(r.li,{children:"Wait for at least 1 minute, but no longer than 24 hours."}),"\n",(0,t.jsx)(r.li,{children:"Submit a registration request for the name, along with the secret value from #1."}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"This process ensures that registrations cannot be frontrun unless the attacker is able to censor the user's transactions for at least 1 minute."}),"\n",(0,t.jsx)(r.h2,{children:"Examples"}),"\n",(0,t.jsx)(r.h3,{children:"Name Registration"}),"\n",(0,t.jsx)(r.p,{children:"The below example demonstrates the steps required to register a name."}),"\n",(0,t.jsx)(o.mQ,{children:(0,t.jsxs)(o.OK,{title:"web3.js",children:[(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-javascript",children:'const controller = web3.eth.contract(controller_abi).at(controller_address);\nasync function register(name, owner, duration) {\n  // Generate a random value to mask our commitment\n  const random = new Uint8Array(32);\n  crypto.getRandomValues(random);\n  const salt = "0x" + Array.from(random).map(b => b.toString(16).padStart(2, "0")).join("");\n  // Submit our commitment to the smart contract\n  const commitment = await controller.makeCommitment(name, owner, salt);\n  const tx = await controller.commit(commitment);\n  // Add 10% to account for price fluctuation; the difference is refunded.\n  const price = (await controller.rentPrice(name, duration)) * 1.1;\n  // Wait 60 seconds before registering\n  setTimeout(async () => {\n    // Submit our registration request\n    await controller.register(name, owner, duration, salt, {value: price});\n  }, 60000);\n}\n'})}),(0,t.jsx)(o.UW,{type:"info",children:(0,t.jsx)(r.p,{children:"For clarity, this example is written using async rather than callbacks. As a result, this example works in web3 1.0.x; note that it will not work in the web3 injected by MetaMask, as this presently is an older version lacking async support."})})]})}),"\n",(0,t.jsx)(r.h2,{children:"Read Operations"}),"\n",(0,t.jsx)(r.h3,{children:"Get Minimum Commitment Age"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"uint constant public MIN_COMMITMENT_AGE;\n"})}),"\n",(0,t.jsx)(r.p,{children:"This public constant provides the minimum commitment age, in seconds. A commitment can only be revealed after at least this many seconds have passed since it was mined."}),"\n",(0,t.jsx)(r.p,{children:"DApps should fetch this constant rather than hardcoding the current value, as it's possible it will change with future releases."}),"\n",(0,t.jsx)(r.h3,{children:"Get Maximum Commitment Age"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"uint constant public MAX_COMMITMENT_AGE;\n"})}),"\n",(0,t.jsx)(r.p,{children:"This public constant provides the maximum commitment age, in seconds. A commitment that was mined more than this number of seconds ago is no longer valid, and cannot be used to register a name."}),"\n",(0,t.jsx)(r.p,{children:"DApps should fetch this constant rather than hardcoding the current value, as it's possible it will change with future releases."}),"\n",(0,t.jsx)(r.h3,{children:"Get Minimum Registration Duration"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"uint constant public MIN_REGISTRATION_DURATION;\n"})}),"\n",(0,t.jsx)(r.p,{children:"This public constant provides the minimum registration duration, in seconds. Registrations for less than this duration will be rejected."}),"\n",(0,t.jsx)(r.p,{children:"DApps should fetch this constant rather than hardcoding the current value, as it's possible it will change with future releases."}),"\n",(0,t.jsx)(r.h3,{children:"Get Commitment Timestamp"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"mapping(bytes32=>uint) public commitments;\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"commitments"})," stores a mapping from each submitted to commitment to the timestamp at which it was made. Callers wishing to validate that a commitment is valid before submitting a registration transaction should check this map first."]}),"\n",(0,t.jsx)(r.h3,{children:"Get Rent Price"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function rentPrice(string name, uint duration) view public returns(uint);\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"rentPrice"})," returns the cost, in wei, to register or renew the provided name for the provided duration, in seconds. Callers should note that this price may vary over time, particularly if the pricing oracle is relying on a fiat price conversion."]}),"\n",(0,t.jsx)(r.p,{children:"Callers should use this function to obtain registration costs to display to the user rather than calculating them internally, as future changes to the pricing oracle may result in different pricing schemes, with registration cost-per-year depending on name length, registration duration, or other variables."}),"\n",(0,t.jsx)(r.h3,{children:"Check Name Validity"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function valid(string name) public view returns(bool);\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"valid"})," returns true iff name is valid for registration with this controller (eg, it meets length requirements)."]}),"\n",(0,t.jsx)(r.h3,{children:"Check Name Availability"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function available(string name) public view returns(bool);\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"available"})," returns true iff the name is both valid and available for registration by this controller. ",(0,t.jsx)(r.a,{href:"https://github.com/ensdomains/ethregistrar/blob/master/contracts/ETHRegistrarController.sol#L55-L58",children:"Under the hood"}),", this call uses the ",(0,t.jsx)(r.code,{children:"valid"})," function (above) and the ",(0,t.jsx)(r.code,{children:"available"})," function on the ",(0,t.jsx)(r.a,{href:"registrar.md#check-name-availability",children:"registrar"})," contract, which checks for availability in both the legacy ENS registrar and current ENS registrar."]}),"\n",(0,t.jsxs)(r.p,{children:["Callers ",(0,t.jsx)(r.strong,{children:"should"})," use this function to check if a name is available for registration, rather than the ",(0,t.jsx)(r.code,{children:"available"})," function on the registrar contract, which does not check name length."]}),"\n",(0,t.jsx)(r.h3,{children:"Calculate Commitment Hash"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function makeCommitment(string name, address owner, bytes32 secret) pure public returns(bytes32);\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"makeCommitment"})," generates and returns a commitment hash from a name label (eg, 'myname', not 'myname.eth') owner, and secret value."]}),"\n",(0,t.jsx)(r.h2,{children:"Write Operations"}),"\n",(0,t.jsx)(r.h3,{children:"Submit Commitment"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function commit(bytes32 commitment) public;\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"commit"})," submits a precommitment generated by calling ",(0,t.jsx)(r.a,{href:"controller.md#calculate-commitment-hash",children:"makeCommitment"}),"."]}),"\n",(0,t.jsx)(r.h3,{children:"Register Name"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function register(string name, address owner, uint duration, bytes32 secret) public payable;\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"register"})," registers a name. A valid registration request must meet the following criteria:"]}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"available(name) == true"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"duration >= MIN_REGISTRATION_DURATION"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"secret"})," identifies a valid commitment (eg, ",(0,t.jsx)(r.code,{children:"commitments[makeCommitment(name, secret)]"})," exists and is between 1 minute and 24 hours old."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"msg.value >= rentPrice(name, duration)"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["Because the rent price may vary over time, callers are recommended to send slightly more than the value returned by ",(0,t.jsx)(r.code,{children:"rentPrice"})," - a premium of 5-10% will likely be sufficient. Any excess funds are returned to the caller."]}),"\n",(0,t.jsx)(r.p,{children:"Emits the following event on a successful call:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"event NameRegistered(string name, bytes32 indexed label, address indexed owner, uint cost, uint expires);\n"})}),"\n",(0,t.jsxs)(r.p,{children:["A successful call also results in the Registrar emitting a ",(0,t.jsx)(r.a,{href:"registrar.md#name-registered",children:"Name Registered Event"}),", and the ENS registry emitting a ",(0,t.jsx)(r.a,{href:"../ens.md#set-subdomain-owner",children:"New Owner Event"}),"."]}),"\n",(0,t.jsx)(r.h3,{children:"Extend Name Registration"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"function renew(string name, uint duration) external payable;\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"renew"})," renews a name, extending the name's expiration by ",(0,t.jsx)(r.code,{children:"duration"})," seconds. This function can be called by anyone, as long as sufficient funds are provided. Because the rent price may vary over time, callers are recommended to send slightly more than the value returned by ",(0,t.jsx)(r.code,{children:"rentPrice"})," - a premium of 5-10% will likely be sufficient. Any excess funds are returned to the caller."]}),"\n",(0,t.jsx)(r.p,{children:"Emits the following event on a successful call:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"event NameRenewed(string name, bytes32 indexed label, uint cost, uint expires);\n"})}),"\n",(0,t.jsxs)(r.p,{children:["A successful call also results in the Registrar emitting a ",(0,t.jsx)(r.a,{href:"registrar.md#name-renewed",children:"Name Renewed Event"}),"."]})]})}r.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.jsx)(c,Object.assign({},e,{children:(0,t.jsx)(l,e)}))}}},function(e){e.O(0,[8164,3248,9774,2888,179],(function(){return r=137,e(e.s=r);var r}));var r=e.O();_N_E=r}]);