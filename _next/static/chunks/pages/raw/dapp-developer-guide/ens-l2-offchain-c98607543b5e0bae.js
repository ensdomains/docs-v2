(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6804],{8905:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/raw/dapp-developer-guide/ens-l2-offchain",function(){return n(3972)}])},3972:function(e,r,n){"use strict";n.r(r);var t=n(4637),a=n(6988),s=n(1177),o=n(9577),i=function(e){return(0,s.withSSG)((0,a.Z)({filename:"ens-l2-offchain.mdx",route:"/raw/dapp-developer-guide/ens-l2-offchain",meta:{},pageMap:[{name:"developer",children:[{name:"basics",route:"/developer/basics"},{name:"getting-started",route:"/developer/getting-started"},{name:"index",route:"/developer"},{name:"meta.json",meta:{index:{title:"Developer Documentation",type:"docs",theme:{}},"getting-started":{title:"Getting Started",type:"docs"},basics:{title:"Basics",type:"docs"},"working-directly-with-ens":{title:"Manual Contract API",type:"docs"}},locale:"en-US"},{name:"working-directly-with-ens",route:"/developer/working-directly-with-ens"}],route:"/developer"},{name:"governance",children:[{name:"index",route:"/governance"},{name:"meta.json",meta:{index:{title:"Governance Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/governance"},{name:"index",route:"/",frontMatter:{title:"Welcome"}},{name:"meta.json",meta:{index:{title:"Introduction",type:"docs",hidden:!0,theme:{}},about:{title:"About ENS",type:"docs",hidden:!0,theme:{}},user:{title:"User",type:"nav"},developer:{title:"Developer",type:"nav"},technical:{title:"Technical",type:"nav"},governance:{title:"Governance",type:"nav"},raw:{title:"Raw",type:"hidden"}},locale:"en-US"},{name:"raw",children:[{name:"SUMMARY",route:"/raw/SUMMARY"},{name:"bug-bounty-program",route:"/raw/bug-bounty-program"},{name:"contract-api-reference",children:[{name:"ENS-Contracts-Overview",route:"/raw/contract-api-reference/ENS-Contracts-Overview"},{name:"dns-registrar",route:"/raw/contract-api-reference/dns-registrar"},{name:"ens",route:"/raw/contract-api-reference/ens",frontMatter:{description:"The ENS registry."}},{name:"eth-permanent-registrar",children:[{name:"README",route:"/raw/contract-api-reference/eth-permanent-registrar/README"},{name:"controller",route:"/raw/contract-api-reference/eth-permanent-registrar/controller"},{name:"registrar",route:"/raw/contract-api-reference/eth-permanent-registrar/registrar"}],route:"/raw/contract-api-reference/eth-permanent-registrar"},{name:"name-processing",route:"/raw/contract-api-reference/name-processing",frontMatter:{description:"Describes how to normalize and hash ENS names."}},{name:"publicresolver",route:"/raw/contract-api-reference/publicresolver",frontMatter:{description:"The default public resolver."}},{name:"reverseregistrar",route:"/raw/contract-api-reference/reverseregistrar",frontMatter:{description:"The registrar responsible for managing reverse resolution via the .addr.reverse special-purpose TLD."}},{name:"testregistrar",route:"/raw/contract-api-reference/testregistrar"}],route:"/raw/contract-api-reference"},{name:"contract-developer-guide",children:[{name:"resolving-names-on-chain",route:"/raw/contract-developer-guide/resolving-names-on-chain"},{name:"writing-a-registrar",route:"/raw/contract-developer-guide/writing-a-registrar"},{name:"writing-a-resolver",route:"/raw/contract-developer-guide/writing-a-resolver"}],route:"/raw/contract-developer-guide"},{name:"dapp-developer-guide",children:[{name:"ens-as-nft",route:"/raw/dapp-developer-guide/ens-as-nft"},{name:"ens-l2-offchain",route:"/raw/dapp-developer-guide/ens-l2-offchain"},{name:"front-end-design-guidelines",route:"/raw/dapp-developer-guide/front-end-design-guidelines",frontMatter:{description:"ENS is a tool to simplify the experience for your users. Here are a series of guidelines and tools that will help you make design choices and implement the best ENS user experience."}},{name:"managing-names",route:"/raw/dapp-developer-guide/managing-names"},{name:"registering-and-renewing-names",route:"/raw/dapp-developer-guide/registering-and-renewing-names"},{name:"resolving-names",route:"/raw/dapp-developer-guide/resolving-names"}],route:"/raw/dapp-developer-guide"},{name:"deploying-ens-on-a-private-chain",route:"/raw/deploying-ens-on-a-private-chain"},{name:"dns-registrar-guide",route:"/raw/dns-registrar-guide"},{name:"ens-deployments",route:"/raw/ens-deployments"},{name:"ens-improvement-proposals",children:[{name:"README",route:"/raw/ens-improvement-proposals/README",frontMatter:{description:"Standards documentation describing the ENS protocol"}},{name:"ensip-1-ens",route:"/raw/ens-improvement-proposals/ensip-1-ens",frontMatter:{description:"Documentation of the basic ENS protocol (formerly EIP-137)."}},{name:"ensip-10-wildcard-resolution",route:"/raw/ens-improvement-proposals/ensip-10-wildcard-resolution",frontMatter:{description:"Provides a mechanism to support wildcard resolution of ENS names (formerly EIP-2544)."}},{name:"ensip-11-evmchain-address-resolution",route:"/raw/ens-improvement-proposals/ensip-11-evmchain-address-resolution",frontMatter:{description:"Introduces coinType for EVM compatible chains (amending ENSIP9)."}},{name:"ensip-12-avatar-text-records",route:"/raw/ens-improvement-proposals/ensip-12-avatar-text-records",frontMatter:{description:"A standard for storage of the avatar text record in ENS."}},{name:"ensip-2-initial-hash-registrar",route:"/raw/ens-improvement-proposals/ensip-2-initial-hash-registrar",frontMatter:{description:"Describes the hash registrar initially used to register ENS .eth domains (formerly EIP-162)."}},{name:"ensip-3-reverse-resolution",route:"/raw/ens-improvement-proposals/ensip-3-reverse-resolution",frontMatter:{description:"Specifies a TLD, registrar, and resolver interface for reverse resolution of Ethereum addresses using ENS (formerly EIP-181)."}},{name:"ensip-4-support-for-contract-abis",route:"/raw/ens-improvement-proposals/ensip-4-support-for-contract-abis",frontMatter:{description:"A mechanism for storing ABI definitions in ENS, for easy lookup of contract interfaces by callers (formerly EIP-205)."}},{name:"ensip-5-text-records",route:"/raw/ens-improvement-proposals/ensip-5-text-records",frontMatter:{description:"A standard for storage of text records in ENS (formerly EIP-634)."}},{name:"ensip-6-dns-in-ens",route:"/raw/ens-improvement-proposals/ensip-6-dns-in-ens",frontMatter:{description:"Defines a resolver profile for ENS that provides features for storage and lookup of DNS records (formerly EIP-1185)."}},{name:"ensip-7-contenthash-field",route:"/raw/ens-improvement-proposals/ensip-7-contenthash-field",frontMatter:{description:"Introduces a field for storing content addresses and hashes in ENS (formerly EIP-1577)."}},{name:"ensip-8-interface-discovery",route:"/raw/ens-improvement-proposals/ensip-8-interface-discovery",frontMatter:{description:"Defines a method of associating contract interfaces with ENS names and addresses, and of discovering those interfaces (formerly EIP-1844)."}},{name:"ensip-9-multichain-address-resolution",route:"/raw/ens-improvement-proposals/ensip-9-multichain-address-resolution",frontMatter:{description:"Introduces new overloads for the `addr` field for ENS resolvers, which permit resolution of addresses for other blockchains via ENS (formerly EIP-2304)."}}],route:"/raw/ens-improvement-proposals"},{name:"ens-migration-february-2020",children:[{name:"guide-for-dapp-developers",route:"/raw/ens-migration-february-2020/guide-for-dapp-developers"},{name:"technical-description",route:"/raw/ens-migration-february-2020/technical-description"}],route:"/raw/ens-migration-february-2020"},{name:"frequently-asked-questions",route:"/raw/frequently-asked-questions"},{name:"permanent-registrar-faq",route:"/raw/permanent-registrar-faq"},{name:"terminology",route:"/raw/terminology"}],route:"/raw"},{name:"technical",children:[{name:"about",route:"/technical/about"},{name:"index",route:"/technical"},{name:"meta.json",meta:{index:{title:"Technical Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/technical"},{name:"user",children:[{name:"index",route:"/user"},{name:"meta.json",meta:{index:{title:"User Documentation",type:"docs",theme:{}}},locale:"en-US"}],route:"/user"}]},o.Z))(e)};function d(e){var r=Object.assign({h1:"h1",h2:"h2",p:"p",a:"a",ul:"ul",li:"li",strong:"strong",h3:"h3",code:"code",pre:"pre"},e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{children:"ENS Layer2 and offchain data support"}),"\n",(0,t.jsx)(r.h2,{children:"Summary"}),"\n",(0,t.jsxs)(r.p,{children:["With the proliferation of layer 2 solutions for Ethereum that are starting to reach maturity, it's important that ENS is able to provide resolution services across the entire ecosystem, as well as making it possible for ENS users to take advantage of the efficiencies made possible by Layer 2 solutions. Subsequent to a post by ",(0,t.jsx)(r.a,{href:"https://ethereum-magicians.org/t/a-general-purpose-l2-friendly-ens-standard/4591",children:"Vitalik"}),' that suggested a possible means for this, the ENS team and the wider ENS and L2 community have been working on a general-purpose "Layer 2 bridge" that makes cross-platform interoperability possible for both ENS and other applications that need to be able to retrieve data from a variety of offchain sources (any data that resides outside of Ethereum Mainnet also known as layer 1/L1. This includes both propriety database and layer 2/L2 solutions such as Optimism, Arbitrum, Starkware, ZKSync, and so on) in a trustless fashion and came up with standards.']}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://eips.ethereum.org/EIPS/eip-3668",children:"EIP-3668: CCIP Read: Secure offchain data retrieval"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"/ens-improvement-proposals/ensip-10-wildcard-resolution/",children:"ENSIP 10: Wildcard Resolution"})}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"EIP 3668"})," allows for offchain (including Layer 2/L2) lookups of data in a way that is transparent to clients and provides contract authors to implement whatever validation is necessary; in many cases, this can be provided without any additional trust assumptions over and above those required if data is stored onchain."]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"ENSIP 10"})," is a general way to resolve wildcard (eg: *.foo.eth) on L1. Issuing subdomains and moving the resolution of the parent name offchain allows dapps to create subdomains offchain yet make it accessible through L1."]}),"\n",(0,t.jsx)(r.h2,{children:"Steps required for Dapps and wallets to support offchain data lookup."}),"\n",(0,t.jsx)(r.p,{children:"If your dapps or wallets use one of those libraries, the EIP 3668 and ENSIP 10 support will be built in, so simply update the library when ready."}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://github.com/ethers-io/ethers.js",children:"ethersjs"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://github.com/ethereum/web3.js",children:"web3js"})}),"\n"]}),"\n",(0,t.jsx)(r.h3,{children:"ethersjs"}),"\n",(0,t.jsx)(r.p,{children:"5.6.1 supports both EIP3668 and ENSIP 10."}),"\n",(0,t.jsxs)(r.p,{children:["No code change is required as long as your app is interacting with ENS through ",(0,t.jsx)(r.a,{href:"https://docs.ethers.io/v5/api/providers/provider/#Provider--ens-methods",children:"etherjs ENS methods"}),"."]}),"\n",(0,t.jsxs)(r.p,{children:["To try out these features, ",(0,t.jsx)(r.code,{children:"offchainexample.eth"}),' points to so-called "offchain resolver" that fetches data from JSON configuration file hosted on google app engine. It will reply data to any record for offchainexample.eth and its subdomain record such as ',(0,t.jsx)(r.code,{children:"2.offchainexample.eth"}),". The example resolver is not using L2 data but the same mechanism works when the L2 resolver becomes ready."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"const { ethers } = require(\"ethers\");\nconst url = `https://mainnet.infura.io/v3/${process.env.API_KEY}`\nconst provider = new ethers.providers.JsonRpcProvider(url);\n\nasync function main(){\n  let resolver = await provider.getResolver('1.offchainexample.eth')\n  let address = await provider.resolveName('1.offchainexample.eth')\n  let email = await resolver.getText('email')\n  console.log({resolver:resolver.address, address, email})\n}\nmain()\n"})}),"\n",(0,t.jsx)(r.p,{children:"The expected output is as follows."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-raw",children:"$ node index.js\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"{\n  resolver: '0xC1735677a60884ABbCF72295E88d47764BeDa282',\n  address: '0x41563129cDbbD0c5D3e1c86cf9563926b243834d',\n  email: 'nick@ens.domains'\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.a,{href:"@chainlink/ethers-ccip-read-provider/",children:"@chainlink/ethers-ccip-read-provider"}),"(",(0,t.jsx)(r.a,{href:"https://github.com/smartcontractkit/ccip-read/tree/rewrite/packages/ethers-ccip-read-provider",children:"source"}),") also implements EIP 3668 as an independent npm module"]}),"\n",(0,t.jsx)(r.p,{children:"The basic usage example is as follows."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"import { CCIPReadProvider } from '@chainlink/ethers-ccip-read-provider';\nimport { abi as IExtendedResolver_abi } from '@ensdomains/offchain-resolver-contracts/artifacts/contracts/IExtendedResolver.sol/IExtendedResolver.json';\nconst IExtendedResolver = new ethers.utils.Interface(IExtendedResolver_abi);\nconst baseProvider = ethers.getDefaultProvider(options.provider);\nconst provider = new CCIPReadProvider(baseProvider);\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Please refer to ",(0,t.jsx)(r.a,{href:"https://github.com/ensdomains/offchain-resolver/blob/main/packages/client/src/index.ts#L46",children:"offchain resolver client example code"})," for more detail."]}),"\n",(0,t.jsx)(r.h3,{children:"web3js"}),"\n",(0,t.jsx)(r.p,{children:"Work in progress"}),"\n",(0,t.jsx)(r.h3,{children:"Any other libraries"}),"\n",(0,t.jsxs)(r.p,{children:["If you use other libraries or custom integration, please raise the GitHub issue to the project repo or at ",(0,t.jsx)(r.a,{href:"https://github.com/ensdomains/pm/issues",children:"ENS project management repo"})," if the equivalent repo does not exist so that ENS team can keep track of the progress."]}),"\n",(0,t.jsx)(r.h2,{children:"Steps required for Dapps and wallets to issue subdomains offchain"}),"\n",(0,t.jsxs)(r.p,{children:["If you wish to issue subdomains using offchain data storage, please follow ",(0,t.jsx)(r.a,{href:"https://github.com/ensdomains/offchain-resolver",children:"offchain resolver"})," as a reference point. The example uses a flat file as a data source but can easily be replaced with database calls."]}),"\n",(0,t.jsx)(r.p,{children:"L2 support is still a work in progress."}),"\n",(0,t.jsx)(r.h2,{children:"FAQ"}),"\n",(0,t.jsx)(r.h3,{children:"Is the change backwards compatible?"}),"\n",(0,t.jsx)(r.p,{children:"Yes. The existing names on L1 will continue working without clients nor applications supporting these standards. Only names that are outside of L1 will not be resolved."}),"\n",(0,t.jsx)(r.h3,{children:"Will L2/offchain data be supported by GraphQL?"}),"\n",(0,t.jsx)(r.p,{children:"Once each L2 is officially supported, we will need to spin up a subgraph for each L2 bridge, and we will use schema stitching to make using them transparent to callers."}),"\n",(0,t.jsx)(r.p,{children:"For names that are not hosted on a supported L2, we won't be able to fetch data that are normally only available on the subgraph"}),"\n",(0,t.jsx)(r.h3,{children:"How do you support other EVM compatible chains?"}),"\n",(0,t.jsx)(r.p,{children:"Non-L2 chains lack ways to verify data on L1 in the trustless manner. The alternative is for chain bridge operators to act as a trusted third-party and hosts the offchain gateway, or individual dapps hosts own gateway and sign each data with the private key of the ENS name."}),"\n",(0,t.jsx)(r.h3,{children:"Can I issue a new tld unique to an offchain environment?"}),"\n",(0,t.jsxs)(r.p,{children:["No. Please read ",(0,t.jsx)(r.a,{href:"https://medium.com/the-ethereum-name-service/why-ens-doesnt-create-more-tlds-responsible-citizenship-in-the-global-namespace-7e66658fe2b1",children:'"Why ENS Doesn\'t Create More TLDs: Responsible Citizenship in the Global Namespace"'})," for more detail"]}),"\n",(0,t.jsx)(r.h3,{children:"Can I set a primary name to names on offchain?"}),"\n",(0,t.jsx)(r.p,{children:"Yes, you can. However, reverse registrar (it is a hidden top-level domain starting with .addr.reverse) currently resides on L1; hence you have to pay gas on L1. We may consider moving the reverse registrar to L2 in future."}),"\n",(0,t.jsx)(r.h3,{children:"Can I register .eth name on offchain?"}),"\n",(0,t.jsx)(r.p,{children:"Only when we migrate .eth name to a specific L2 as one of the last steps of our migration after finding out which L2 supports ENS integration the best."}),"\n",(0,t.jsx)(r.h3,{children:"How do I handle contract addresses?"}),"\n",(0,t.jsxs)(r.p,{children:["Unlike EOA (Externally Owned Account), contract based accounts such as multisig may only be accessible in certain chains. ",(0,t.jsx)(r.a,{href:"ens-improvement-proposals/ensip-11-evmchain-address-resolution.md",children:"ENSIP-11"})," allows a single name to hold different addresses across multiple EVM compatible chains and recommendation is to store contract addresses to EVM chain specific address record field."]}),"\n",(0,t.jsx)(r.h3,{children:"Can I use libraries from other name services that support .eth?"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"@unstoppabledomains/resolution"})," removed ",(0,t.jsx)(r.a,{href:"https://github.com/unstoppabledomains/resolution/releases/tag/v7.0.0",children:"ENS support as of December 2021"}),". Other services tend not to support all ENS TLDs especially DNS based TLDs (.com, .net, etc) so we advise not to rely on these libraries resolving ENS names."]}),"\n",(0,t.jsx)(r.h2,{children:"References and previous discussions"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://medium.com/the-ethereum-name-service/mvp-of-ens-on-l2-with-optimism-demo-video-how-to-try-it-yourself-b44c390cbd67",children:"MVP of ENS on L2 with Optimism: Demo Video + How to Try It Yourself"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://medium.com/the-ethereum-name-service/a-general-purpose-bridge-for-ethereum-layer-2s-e28810ec1d88",children:"A general-purpose bridge for Ethereum Layer 2s"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://ethereum-magicians.org/t/a-general-purpose-l2-friendly-ens-standard/4591",children:"A general-purpose L2-friendly ENS standard"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://www.youtube.com/watch?v=L9N7U_bNmOU",children:"Video: ENS Workshop on 18th Oct 2021"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://www.youtube.com/watch?v=9DdL7AQgXTM",children:"Video: ENS Workshop on 6th April 2021"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://www.youtube.com/watch?v=QwEiAedSNYI",children:"Video: ENS on Layer 2 meeting #2 on 28th Oct 2020"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://www.youtube.com/watch?v=vloI0VT8DXE",children:"Video: ENS on Layer 2 meeting on 13th Oct 2020"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://www.youtube.com/watch?v=65z_j4n8mTk&t=2s",children:"Video: ENS workshop on 29th Sep 2020"})}),"\n"]})]})}r.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.jsx)(i,Object.assign({},e,{children:(0,t.jsx)(d,e)}))}}},function(e){e.O(0,[8164,9214,9774,2888,179],(function(){return r=8905,e(e.s=r);var r}));var r=e.O();_N_E=r}]);